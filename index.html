<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cronograma Formaci√≥n IA - Alianza</title>

    <!-- Tailwind (CDN) -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- React 18 (CDN) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

    <!-- Babel para JSX (solo para demos / GitHub Pages simples) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Lucide Icons (CDN) -->
    <script src="https://unpkg.com/lucide@latest"></script>
  </head>

  <body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
      const { useState, useEffect } = React;

      function Icon({ name, className = "", size = 20 }) {
        // Lucide usa <i data-lucide="..."> y luego lucide.createIcons()
        return (
          <i
            data-lucide={name}
            className={className}
            style={{ width: size, height: size }}
          ></i>
        );
      }

      const CronogramaFormacion = () => {
        const [confirmations, setConfirmations] = useState({});
        const [showModal, setShowModal] = useState(false);
        const [currentSession, setCurrentSession] = useState(null);
        const [formData, setFormData] = useState({
          nombre: "",
          coordinacion: "",
          cargo: "",
          propuestas: "",
          confirma: true,
          requiereReprogramacion: false,
          motivoReprogramacion: "",
        });

        const direccionesOficina = [
          "Administrativa y Financiera",
          "Socioemocional",
          "Proyectos",
          "Talento Humano",
          "Acad√©mica",
        ];

        const colegios = [
          "Colegio Argelia",
          "Colegio Santiago de las Atalayas",
          "Colegio Giralda",
          "Colegio Jaime Garz√≥n",
          "Colegio Miravalle",
          "Colegio Ciudad Chengd√∫",
          "Colegio Jorge Isaacs",
          "Colegio Laurel de Cera",
          "Colegio Margaritas",
          "Colegio El Nogal",
          "Colegio Parques de Bogot√°",
        ];

        const generarFechasLaborales = (inicio, fin) => {
          const fechas = [];
          let actual = new Date(inicio);
          const final = new Date(fin);

          while (actual <= final) {
            const diaSemana = actual.getDay();
            if (diaSemana !== 0 && diaSemana !== 6) {
              fechas.push(new Date(actual));
            }
            actual.setDate(actual.getDate() + 1);
          }
          return fechas;
        };

        const programarSesiones = () => {
          const sesiones = [];

          // Ajustado a 2026 (seg√∫n tu etapa Febrero-Marzo 2026)
          const fechasFebreroOficina = generarFechasLaborales("2026-02-02", "2026-02-27");
          const semanasOficina = [];

          for (let i = 0; i < fechasFebreroOficina.length; i += 5) {
            semanasOficina.push(fechasFebreroOficina[i]);
          }

          direccionesOficina.forEach((direccion, idx) => {
            if (semanasOficina[idx]) {
              sesiones.push({
                id: `oficina-${idx}`,
                tipo: "Oficina Central",
                nombre: direccion,
                fecha: semanasOficina[idx],
                hora: "9:00 AM - 11:00 AM",
                cupos: 25,
                registrados: 0,
              });
            }
          });

          const fechasColegios = generarFechasLaborales("2026-02-23", "2026-03-27");

          colegios.forEach((colegio, idx) => {
            if (fechasColegios[idx * 2]) {
              sesiones.push({
                id: `colegio-${idx}`,
                tipo: "Colegio",
                nombre: colegio,
                fecha: fechasColegios[idx * 2],
                hora: "2:00 PM - 4:00 PM",
                cupos: 30,
                registrados: 0,
              });
            }
          });

          return sesiones.sort((a, b) => a.fecha - b.fecha);
        };

        const [sesiones] = useState(programarSesiones());

        const formatearFecha = (fecha) => {
          if (!fecha) return "";
          return fecha.toLocaleDateString("es-CO", {
            weekday: "long",
            year: "numeric",
            month: "long",
            day: "numeric",
          });
        };

        const handleConfirmar = (sesion) => {
          setCurrentSession(sesion);
          setFormData({
            nombre: "",
            coordinacion: "",
            cargo: "",
            propuestas: "",
            confirma: true,
            requiereReprogramacion: false,
            motivoReprogramacion: "",
          });
          setShowModal(true);
        };

        const enviarAGoogleSheets = async (datos) => {
          // Reemplaza con tu URL del Web App de Google Apps Script
          const SHEET_URL = "TU_URL_DE_GOOGLE_APPS_SCRIPT_AQUI";

          try {
            await fetch(SHEET_URL, {
              method: "POST",
              mode: "no-cors",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(datos),
            });

            console.log("Datos enviados a Google Sheets:", datos);
            return true;
          } catch (error) {
            console.error("Error al enviar a Google Sheets:", error);
            return false;
          }
        };

        const handleSubmit = async () => {
          if (!formData.nombre || !formData.coordinacion || !formData.cargo) {
            alert("Por favor completa los campos obligatorios (*)");
            return;
          }

          if (
            currentSession.tipo === "Colegio" &&
            formData.requiereReprogramacion &&
            !formData.motivoReprogramacion
          ) {
            alert("Por favor indica el motivo de la reprogramaci√≥n");
            return;
          }

          const registroCompleto = {
            nombre: formData.nombre,
            coordinacion: formData.coordinacion,
            cargo: formData.cargo,
            propuestas: formData.propuestas,
            sesion: currentSession.nombre,
            tipo: currentSession.tipo,
            fecha: formatearFecha(currentSession.fecha),
            hora: currentSession.hora,
            confirma: currentSession.tipo === "Colegio" ? formData.confirma : "N/A",
            requiereReprogramacion:
              currentSession.tipo === "Colegio" ? formData.requiereReprogramacion : "N/A",
            motivoReprogramacion:
              currentSession.tipo === "Colegio" ? formData.motivoReprogramacion : "N/A",
            timestamp: new Date().toISOString(),
          };

          await enviarAGoogleSheets(registroCompleto);

          setConfirmations({
            ...confirmations,
            [currentSession.id]: true,
          });

          setShowModal(false);
          alert("¬°Registro exitoso! Se ha guardado tu informaci√≥n en Google Sheets.");
        };

        const exportarCronograma = () => {
          const csv = sesiones
            .map((s) => `${s.tipo},${s.nombre},${formatearFecha(s.fecha)},${s.hora},${s.cupos}`)
            .join("\n");

          const blob = new Blob([`Tipo,Nombre,Fecha,Hora,Cupos\n${csv}`], {
            type: "text/csv",
          });
          const url = window.URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          a.download = "cronograma_formacion_ia_2026.csv";
          a.click();
        };

        // Renderiza √≠conos Lucide cada vez que cambia el UI
        useEffect(() => {
          if (window.lucide && typeof window.lucide.createIcons === "function") {
            window.lucide.createIcons();
          }
        }, [showModal, currentSession, confirmations]);

        return (
          <div className="min-h-screen bg-gradient-to-br from-indigo-100 via-purple-50 to-pink-100 p-6">
            <div className="max-w-7xl mx-auto mb-8">
              <div className="bg-white rounded-2xl shadow-2xl p-8 border-t-4 border-indigo-600">
                <div className="flex items-center justify-between flex-wrap gap-4">
                  <div>
                    <h1 className="text-4xl font-bold text-gray-800 mb-2 flex items-center gap-3">
                      <span className="text-indigo-600 inline-flex items-center">
                        <Icon name="calendar" size={40} />
                      </span>
                      Formaci√≥n en IA - Alianza 2026
                    </h1>
                    <p className="text-gray-600 text-lg">Primera Etapa: Febrero - Marzo 2026</p>
                  </div>

                  <button
                    onClick={exportarCronograma}
                    className="flex items-center gap-2 bg-indigo-600 text-white px-6 py-3 rounded-lg hover:bg-indigo-700 transition-all shadow-lg hover:shadow-xl"
                  >
                    <Icon name="download" size={20} />
                    Exportar Cronograma
                  </button>
                </div>
              </div>
            </div>

            <div className="max-w-7xl mx-auto mb-6 grid grid-cols-1 md:grid-cols-2 gap-4">
              <div className="bg-gradient-to-r from-blue-500 to-blue-600 text-white p-4 rounded-xl shadow-lg">
                <div className="flex items-center gap-3">
                  <Icon name="building-2" size={24} />
                  <div>
                    <h3 className="font-bold text-lg">Oficina Central</h3>
                    <p className="text-sm opacity-90">5 Direcciones - Febrero</p>
                  </div>
                </div>
              </div>
              <div className="bg-gradient-to-r from-purple-500 to-purple-600 text-white p-4 rounded-xl shadow-lg">
                <div className="flex items-center gap-3">
                  <Icon name="users" size={24} />
                  <div>
                    <h3 className="font-bold text-lg">Colegios</h3>
                    <p className="text-sm opacity-90">11 Instituciones - Feb/Mar</p>
                  </div>
                </div>
              </div>
            </div>

            <div className="max-w-7xl mx-auto">
              <div className="bg-white rounded-2xl shadow-2xl p-6">
                <h2 className="text-2xl font-bold text-gray-800 mb-6">Calendario de Sesiones</h2>

                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                  {sesiones.map((sesion) => (
                    <div
                      key={sesion.id}
                      className={`relative rounded-xl p-6 shadow-lg hover:shadow-2xl transition-all duration-300 transform hover:-translate-y-1 ${
                        sesion.tipo === "Oficina Central"
                          ? "bg-gradient-to-br from-blue-50 to-blue-100 border-2 border-blue-300"
                          : "bg-gradient-to-br from-purple-50 to-purple-100 border-2 border-purple-300"
                      }`}
                    >
                      <div
                        className={`absolute top-4 right-4 px-3 py-1 rounded-full text-xs font-bold ${
                          sesion.tipo === "Oficina Central"
                            ? "bg-blue-500 text-white"
                            : "bg-purple-500 text-white"
                        }`}
                      >
                        {sesion.tipo === "Oficina Central" ? "Oficina" : "Colegio"}
                      </div>

                      <h3 className="text-xl font-bold text-gray-800 mb-3 pr-16">
                        {sesion.nombre}
                      </h3>

                      <div className="space-y-2 mb-4">
                        <div className="flex items-center gap-2 text-gray-700">
                          <span className="text-indigo-600 inline-flex items-center">
                            <Icon name="calendar" size={16} />
                          </span>
                          <span className="text-sm font-medium">{formatearFecha(sesion.fecha)}</span>
                        </div>

                        <div className="flex items-center gap-2 text-gray-700">
                          <span className="text-indigo-600 inline-flex items-center">
                            <Icon name="clock" size={16} />
                          </span>
                          <span className="text-sm font-medium">{sesion.hora}</span>
                        </div>

                        <div className="flex items-center gap-2 text-gray-700">
                          <span className="text-indigo-600 inline-flex items-center">
                            <Icon name="users" size={16} />
                          </span>
                          <span className="text-sm font-medium">
                            {sesion.registrados}/{sesion.cupos} cupos
                          </span>
                        </div>
                      </div>

                      {confirmations[sesion.id] ? (
                        <div className="flex items-center gap-2 bg-green-100 text-green-700 px-4 py-2 rounded-lg font-medium">
                          <Icon name="check" size={20} />
                          {sesion.tipo === "Oficina Central" ? "Inscrito" : "Confirmado"}
                        </div>
                      ) : (
                        <button
                          onClick={() => handleConfirmar(sesion)}
                          className="w-full bg-gradient-to-r from-indigo-600 to-purple-600 text-white px-4 py-2 rounded-lg hover:from-indigo-700 hover:to-purple-700 transition-all shadow-md hover:shadow-lg font-medium"
                        >
                          {sesion.tipo === "Oficina Central"
                            ? "Inscribirme"
                            : "Confirmar Asistencia"}
                        </button>
                      )}
                    </div>
                  ))}
                </div>
              </div>
            </div>

            {showModal && (
              <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
                <div className="bg-white rounded-2xl shadow-2xl max-w-md w-full p-8 max-h-[90vh] overflow-y-auto">
                  <div className="flex justify-between items-center mb-6">
                    <h3 className="text-2xl font-bold text-gray-800">
                      {currentSession?.tipo === "Oficina Central"
                        ? "Inscripci√≥n"
                        : "Confirmar Asistencia"}
                    </h3>
                    <button
                      onClick={() => setShowModal(false)}
                      className="text-gray-400 hover:text-gray-600"
                      aria-label="Cerrar"
                    >
                      <Icon name="x" size={24} />
                    </button>
                  </div>

                  <div className="bg-indigo-50 p-4 rounded-lg mb-6">
                    <p className="font-bold text-indigo-900">{currentSession?.nombre}</p>
                    <p className="text-sm text-indigo-700">
                      {formatearFecha(currentSession?.fecha)}
                    </p>
                    <p className="text-sm text-indigo-700">{currentSession?.hora}</p>
                  </div>

                  <div className="space-y-4">
                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-1">
                        Nombre Completo *
                      </label>
                      <input
                        type="text"
                        value={formData.nombre}
                        onChange={(e) => setFormData({ ...formData, nombre: e.target.value })}
                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                        placeholder="Tu nombre completo"
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-1">
                        {currentSession?.tipo === "Oficina Central" ? "Direcci√≥n" : "√Årea"} *
                      </label>
                      <input
                        type="text"
                        value={formData.coordinacion}
                        onChange={(e) =>
                          setFormData({ ...formData, coordinacion: e.target.value })
                        }
                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                        placeholder={
                          currentSession?.tipo === "Oficina Central"
                            ? "Ej: Acad√©mica"
                            : "Ej: Administrativa"
                        }
                      />
                    </div>

                    <div>
                      <label className="block text-sm font-medium text-gray-700 mb-1">
                        Cargo *
                      </label>
                      <input
                        type="text"
                        value={formData.cargo}
                        onChange={(e) => setFormData({ ...formData, cargo: e.target.value })}
                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                        placeholder="Tu cargo actual"
                      />
                    </div>

                    {currentSession?.tipo === "Oficina Central" && (
                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-1">
                          Propuestas de Actividades con IA
                        </label>
                        <textarea
                          value={formData.propuestas}
                          onChange={(e) =>
                            setFormData({ ...formData, propuestas: e.target.value })
                          }
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                          rows="3"
                          placeholder="Comparte tus ideas sobre c√≥mo usar IA en tu √°rea..."
                        />
                      </div>
                    )}

                    {currentSession?.tipo === "Colegio" && (
                      <>
                        <div className="bg-purple-50 p-4 rounded-lg">
                          <label className="flex items-center gap-3 cursor-pointer">
                            <input
                              type="checkbox"
                              checked={formData.requiereReprogramacion}
                              onChange={(e) =>
                                setFormData({
                                  ...formData,
                                  requiereReprogramacion: e.target.checked,
                                  motivoReprogramacion: e.target.checked
                                    ? formData.motivoReprogramacion
                                    : "",
                                })
                              }
                              className="w-5 h-5 text-indigo-600 rounded focus:ring-2 focus:ring-indigo-500"
                            />
                            <div>
                              <span className="text-sm font-medium text-gray-700">
                                Requiere reprogramaci√≥n
                              </span>
                              <p className="text-xs text-gray-500">
                                Marca esta opci√≥n si necesitas cambiar la fecha
                              </p>
                            </div>
                          </label>
                        </div>

                        {formData.requiereReprogramacion && (
                          <div className="bg-yellow-50 border-2 border-yellow-300 p-4 rounded-lg">
                            <div className="flex items-start gap-2 mb-3">
                              <span className="text-yellow-600 mt-1 inline-flex items-center">
                                <Icon name="alert-circle" size={20} />
                              </span>
                              <div>
                                <p className="text-sm font-medium text-yellow-800">
                                  Solicitud de Reprogramaci√≥n
                                </p>
                                <p className="text-xs text-yellow-700">
                                  Por favor indica el motivo de la reprogramaci√≥n
                                </p>
                              </div>
                            </div>
                            <textarea
                              value={formData.motivoReprogramacion}
                              onChange={(e) =>
                                setFormData({
                                  ...formData,
                                  motivoReprogramacion: e.target.value,
                                })
                              }
                              className="w-full px-4 py-2 border border-yellow-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent"
                              rows="3"
                              placeholder="Describe el motivo por el cual necesitas reprogramar esta sesi√≥n..."
                            />
                          </div>
                        )}
                      </>
                    )}

                    <div className="flex gap-3 pt-4">
                      <button
                        onClick={() => setShowModal(false)}
                        className="flex-1 px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors font-medium"
                      >
                        Cancelar
                      </button>
                      <button
                        onClick={handleSubmit}
                        className="flex-1 bg-gradient-to-r from-indigo-600 to-purple-600 text-white px-4 py-2 rounded-lg hover:from-indigo-700 hover:to-purple-700 transition-all shadow-md hover:shadow-lg font-medium"
                      >
                        Confirmar
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            )}

            <div className="max-w-7xl mx-auto mt-8">
              <div className="bg-white rounded-xl shadow-lg p-6">
                <h3 className="font-bold text-gray-800 mb-3">üìå Informaci√≥n Importante</h3>
                <ul className="space-y-2 text-gray-700">
                  <li>
                    ‚úì <strong>Oficina Central:</strong> Sesiones semanales durante febrero
                    (Inscripci√≥n)
                  </li>
                  <li>
                    ‚úì <strong>Colegios:</strong> Sesiones desde √∫ltima semana de febrero y durante
                    marzo (Confirmaci√≥n)
                  </li>
                  <li>‚úì <strong>Duraci√≥n:</strong> 2 horas por sesi√≥n</li>
                  <li>‚úì <strong>Modalidad:</strong> Primera etapa de formaci√≥n 2026</li>
                  <li>‚úì Los registros se guardan autom√°ticamente en Google Sheets</li>
                </ul>
              </div>
            </div>
          </div>
        );
      };

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<CronogramaFormacion />);
    </script>
  </body>
</html>
